{"paragraphs":[{"title":"Some helper functions","text":"%pyspark\n\ndef versionCheck():\n    import sys\n    print(\"Python: \" + sys.version.replace(\"\\n\", \" - \"))\n    print(\"Spark:  \" + sc.version)\n\ndef display(html):\n    print(\"%angular\")\n    print(html)\n\ndef getNoteId():\n    return z.z.getInterpreterContext().getNoteId()\n\ndef getParagraphId():\n    return z.z.getInterpreterContext().getParagraphId()\n\n\nversionCheck()\n","dateUpdated":"2017-03-10T15:13:52+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760647_177902448","id":"20170304-121836_865067366","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:406","user":"bernhard","dateFinished":"2017-03-10T15:13:52+0000","dateStarted":"2017-03-10T15:13:52+0000","result":{"code":"SUCCESS","type":"TEXT","msg":"Python: 3.5.2 |Anaconda 4.3.0 (64-bit)| (default, Jul  2 2016, 17:53:06)  - [GCC 4.4.7 20120313 (Red Hat 4.4.7-1)]\nSpark:  1.6.2\n"},"focus":true},{"title":"Simple Angular variable binding","text":"%pyspark\n\ndisplay(\"\"\"\n\n<b>Hello {{name}} !</b>\n<div>Note Id:      <i>\"%s\"</i> (see browser address line)</div>\n<div>Paragraph Id: <i>\"%s\"</i> (see paragraph menu)</div>\n\n\"\"\" % (getNoteId(), getParagraphId()))\n\nz.z.angularBind(\"name\", \"Zeppelin\")\n","dateUpdated":"2017-03-10T15:13:54+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-210239_1540885795","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:407","user":"bernhard","dateFinished":"2017-03-10T15:13:54+0000","dateStarted":"2017-03-10T15:13:54+0000","result":{"code":"SUCCESS","type":"ANGULAR","msg":"\n<b>Hello {{name}} !</b>\n<div>Note Id:      <i>\"2CA4YSTC7\"</i> (see browser address line)</div>\n<div>Paragraph Id: <i>\"20170304-210239_1540885795\"</i> (see paragraph menu)</div>\n\n"},"focus":true},{"text":"%pyspark\n\nz.z.angularBind(\"name\", \"Apache Zeppelin\")\n","dateUpdated":"2017-03-10T15:13:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170310-155555_57806824","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:408","user":"bernhard","dateFinished":"2017-03-10T15:13:57+0000","dateStarted":"2017-03-10T15:13:57+0000","result":{"code":"SUCCESS","type":"TEXT","msg":""},"focus":true},{"title":"Trigger simple Javascript functions via DOM buttons","text":"%pyspark\n\ndisplay(\"\"\"<button id=\"abcde\" ng-click=\"run = run + 1\">Click {{run}}</button>\"\"\")\n\nz.z.angularBind(\"run\", 0)","dateUpdated":"2017-03-10T15:13:58+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-122140_404002024","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:409","user":"bernhard","dateFinished":"2017-03-10T15:13:58+0000","dateStarted":"2017-03-10T15:13:58+0000","result":{"code":"SUCCESS","type":"ANGULAR","msg":"<button id=\"abcde\" ng-click=\"run = run + 1\">Click {{run}}</button>\n"},"focus":true},{"text":"%md\n## How to trigger Javascript functions: ZeppelinSession, a custom Angular watcher\n\nClicking on some DOM button is sometimes OK, however it would be great to have a way to trigger Javascript functions from Python.\n\nSo let's use the capabilities of `z.z.angularBind`, `z.z.angularUnbind` and `z.z.angular` together with `$scope.$watch` (the Angular way to trigger javascript functions based on changed variables). This is implemnted in the class ZeppelinSession.\n\nPreparation step on the machine running Zeppelin Server:\n\n```\ngit clone https://github.com/bernhard-42/advanced-angular-for-pyspark\ncd advanced-angular-for-pyspark\npip install zeppelin_session    # use the pip command of the python installation used in Zeppelin\n```","dateUpdated":"2017-03-10T15:12:56+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-134854_1991643647","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:410","user":"bernhard","dateFinished":"2017-03-10T15:12:58+0000","dateStarted":"2017-03-10T15:12:56+0000","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>How to trigger Javascript functions: ZeppelinSession, a custom Angular watcher</h2>\n<p>Clicking on some DOM button is sometimes OK, however it would be great to have a way to trigger Javascript functions from Python.</p>\n<p>So let's use the capabilities of <code>z.z.angularBind</code>, <code>z.z.angularUnbind</code> and <code>z.z.angular</code> together with <code>$scope.$watch</code> (the Angular way to trigger javascript functions based on changed variables). This is implemnted in the class ZeppelinSession.</p>\n<p>Preparation step on the machine running Zeppelin Server:</p>\n<pre><code>git clone https://github.com/bernhard-42/advanced-angular-for-pyspark\ncd advanced-angular-for-pyspark\npip install zeppelin_session    # use the pip command of the python installation used in Zeppelin\n</code></pre>\n"},"focus":true},{"text":"%pyspark\nfrom zeppelin_session import ZeppelinSession\n","dateUpdated":"2017-03-10T15:14:03+0000","config":{"lineNumbers":true,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-134950_918281422","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:411","user":"bernhard","dateFinished":"2017-03-10T15:14:03+0000","dateStarted":"2017-03-10T15:14:03+0000","result":{"code":"SUCCESS","type":"TEXT","msg":""},"focus":true},{"title":"Create a new session","text":"%pyspark\n\nsession = ZeppelinSession(z.z)\nsession.init()\n","dateUpdated":"2017-03-10T15:14:05+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-135033_419842332","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:412","user":"bernhard","dateFinished":"2017-03-10T15:14:05+0000","dateStarted":"2017-03-10T15:14:05+0000","result":{"code":"SUCCESS","type":"ANGULAR","msg":"<div id=\"__Zeppelin_Session_2CA4YSTC7_Comm__\">{{__zeppelin_comm_2CA4YSTC7_status__}}</div>\n\n"},"focus":true},{"title":"Start the session (means start Angular watching)","text":"%pyspark\nsession.start()\n","dateUpdated":"2017-03-10T15:14:07+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-162707_558911560","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:413","user":"bernhard","dateFinished":"2017-03-10T15:14:07+0000","dateStarted":"2017-03-10T15:14:07+0000","result":{"code":"SUCCESS","type":"ANGULAR","msg":"You should now see<br><span style=\"margin:20px\"><i>ZeppelinSession started (do not delete this paragraph)</i></span></br> in the paragraph above\n\n<script>\n    var sessionCommVar = \"__zeppelin_comm_2CA4YSTC7_msg__\";\n    var sessionCommDivId = \"__Zeppelin_Session_2CA4YSTC7_Comm__\"\n    var execution_id = \"08408fce-4a7b-4c1e-b1f8-99e628e37eff\";                                                 // Avoid double execution\n    if(window.__zeppelin_already_executed__ == null) {                       //\n        window.__zeppelin_already_executed__ = [];                           //\n    }                                                                        //\n    if(!window.__zeppelin_already_executed__.includes(execution_id)) {       // Avoid double execution\n\n        // Get the angular scope of the session div element\n\n        console.log(\"Get scope for div id\" + sessionCommDivId);\n        var $scope = angular.element(document.getElementById(sessionCommDivId)).scope();\n\n        // make scope easily accessible in Web Console\n\n        window.__zeppelin_comm_scope = $scope;\n\n        // Remove any remaining watcher from last session\n\n        if(typeof(window.__zeppelin_notebook_unwatchers__) !== \"undefined\") {\n            console.info(\"ZeppelinSession: Cancel watchers\");\n            var unwatchers = window.__zeppelin_notebook_unwatchers__\n            for(i in unwatchers) {\n                unwatchers[i]();\n            }\n        }\n        \n        // Array to note all active watchers (as with their respective unwatcher function)\n\n        window.__zeppelin_notebook_unwatchers__ = [];\n\n        // Main Handler\n\n        console.info(\"Install Angular watcher for session comm var \" + sessionCommVar);\n        var unwatch = $scope.$watch(sessionCommVar, function(newValue, oldValue, scope) {\n            if(typeof(newValue) !== \"undefined\") {\n                // console.info(newValue);\n                if (newValue.task === \"call\") {\n\n                    // Format: newValue = {\"id\": int, task\":\"call\", \"msg\":{\"function\":\"func_name\", \"object\":\"json_object\", \"delay\":ms}}\n                    \n                    var data = newValue.msg;\n                    console.log(\"Calling function \" + data.function + \" with delay: \" + data.delay)\n\n                    if (typeof($scope.__functions[data.function]) === \"function\") {\n                        setTimeout(function() {\n                            $scope.__functions[data.function]($scope, data.object);\n                        }, data.delay);\n                    } else {\n                        console.error(\"Unknown function: \" + data.function + \"()\")\n                    }\n                    \n                } else if (newValue.task === \"register\") {\n                    // Format: newValue = {\"id\": int, task\":\"register\", \"msg\":{\"function\":\"func_name\", \"funcBody\":\"function_as_string\"}}\n                    \n                    var data = newValue.msg;\n                    console.log(\"Registering function \" + data.function)\n                    \n                    var func = eval(data.funcBody);\n                    $scope.__functions[data.function] = func;\n                    \n                } else if (newValue.task === \"unregister\") {\n                    \n                    // Format: newValue = {\"id\": int, task\":\"unregister\", \"msg\":{\"function\":\"func_name\"}}\n                    \n                    var data = newValue.msg;\n                    console.log(\"Unregistering function \" + data.function)\n\n                    if (typeof($scope.__functions[data.function]) === \"function\") {\n                        delete $scope.__functions[data.function];\n                    }               \n                    \n                } else if (newValue.task === \"dump\") {\n                    \n                    // Format: newValue = {\"id\": int, task\":\"dump\", \"msg\":{}}\n                    \n                    console.log(\"sessionCommDivId: \", sessionCommDivId);\n                    console.log(\"$scope: \", $scope);\n\n                } else {\n\n                    // Jupyter.notebook.kernel.session.handleMsg(newValue);\n\n                    console.error(\"Unknown task: \" + newValue.task)\n                }\n            }\n        }, true)\n\n        // Initialize the object that will hold the registered functions\n        $scope.__functions = {};\n        \n        // remember unwatch function to clean up later\n        window.__zeppelin_notebook_unwatchers__.push(unwatch)\n\n        // mark init as executed\n        window.__zeppelin_already_executed__.push(execution_id);            // Avoid double execution\n    } else {                                                                //\n        console.info(\"Angular script already executed, skipped\");           //\n    }                                                                       // Avoid double execution\n</script>\n\n"},"focus":true},{"title":"Set and get Javascript variables from python","text":"%pyspark\nsession.setVar(\"myvar\", 10)\nprint(session.getVar(\"myvar\"))","dateUpdated":"2017-03-10T15:14:21+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760648_175978703","id":"20170304-170415_475929524","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:414","user":"bernhard","dateFinished":"2017-03-10T15:14:21+0000","dateStarted":"2017-03-10T15:14:21+0000","result":{"code":"SUCCESS","type":"TEXT","msg":"10\n"},"focus":true},{"text":"%md\n**Note:**\nAngular calls are async. This can't be controlled from Python, so `session.getVar` my be called \"too early\", i.e. before Angular has finished its `$apply()` call.\n\nThat's why `session.getVar` has an additional parameter `delay` (default 200ms) to give Angular a chance to finish. \n\nExample: `session.getVar(\"myvar\", 500)` for 500ms\n","dateUpdated":"2017-03-10T15:14:12+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-220418_1112986702","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:415","user":"bernhard","dateFinished":"2017-03-10T15:14:12+0000","dateStarted":"2017-03-10T15:14:12+0000","result":{"code":"SUCCESS","type":"HTML","msg":"<p><strong>Note:</strong>\n<br  />Angular calls are async. This can't be controlled from Python, so <code>session.getVar</code> my be called &ldquo;too early&rdquo;, i.e. before Angular has finished its <code>$apply()</code> call.</p>\n<p>That's why <code>session.getVar</code> has an additional parameter <code>delay</code> (default 200ms) to give Angular a chance to finish.</p>\n<p>Example: <code>session.getVar(\"myvar\", 500)</code> for 500ms</p>\n"},"focus":true},{"title":"Registering a javascript function","text":"%pyspark\n\njsFunc = \"\"\"\nincrement = function(session, object) {\n    session.myvar +=  object.inc\n}\n\"\"\"\nsession.registerFunction(\"increment\", jsFunc)\n","dateUpdated":"2017-03-10T15:14:23+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-171415_409342668","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:416","user":"bernhard","dateFinished":"2017-03-10T15:14:23+0000","dateStarted":"2017-03-10T15:14:23+0000","result":{"code":"SUCCESS","type":"TEXT","msg":""},"focus":true},{"text":"%md\n**Note:**\nThe first parameter, `session`, is actually the Angular scope. So every variable `xyz` bound via `z.z.angularBind` can be accessed and changed in the function vie `session.xyz`","dateUpdated":"2017-03-10T15:14:25+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170310-155006_57391036","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:417","user":"bernhard","dateFinished":"2017-03-10T15:14:25+0000","dateStarted":"2017-03-10T15:14:25+0000","result":{"code":"SUCCESS","type":"HTML","msg":"<p><strong>Note:</strong>\n<br  />The first parameter, <code>session</code>, is actually the Angular scope. So every variable <code>xyz</code> bound via <code>z.z.angularBind</code> can be accessed and changed in the function vie <code>session.xyz</code></p>\n"},"focus":true},{"title":"Calling the registered function","text":"%pyspark\nsession.call(\"increment\", object={\"inc\":32})\n\nprint(session.getVar(\"myvar\", delay=1000)) # Remember: async call above, so result might be outdated!\n\n","dateUpdated":"2017-03-10T15:14:41+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-174205_174725544","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:418","user":"bernhard","dateFinished":"2017-03-10T15:14:42+0000","dateStarted":"2017-03-10T15:14:41+0000","result":{"code":"SUCCESS","type":"TEXT","msg":"42\n"},"focus":true},{"title":"Finally unregister the function again","text":"%pyspark\n\nsession.unregisterFunction(\"increment\")\n\nsession.call(\"increment\", object={\"inc\":32}) # will now show \"Unknown function: increment()\" in the Browser Javascript Console\n","dateUpdated":"2017-03-10T15:14:45+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-203250_354437753","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:419","user":"bernhard","dateFinished":"2017-03-10T15:14:45+0000","dateStarted":"2017-03-10T15:14:45+0000","result":{"code":"SUCCESS","type":"TEXT","msg":""},"focus":true},{"title":"Log $scope to Browsers Web Console for inspection","text":"%pyspark\nsession._dumpScope()\n","dateUpdated":"2017-03-10T15:14:49+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","title":true,"results":{},"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-191304_776853471","dateCreated":"2017-03-10T15:12:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:420","user":"bernhard","dateFinished":"2017-03-10T15:14:49+0000","dateStarted":"2017-03-10T15:14:49+0000","result":{"code":"SUCCESS","type":"TEXT","msg":"Open the Browser Javascript Console to examine the Angular $scope that holds the Zeppelin Session\n"},"focus":true},{"text":"%pyspark\n","dateUpdated":"2017-03-10T15:12:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"},"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1489158760649_175593955","id":"20170304-220237_374359407","dateCreated":"2017-03-10T15:12:40+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:421"}],"name":"Advanced Angular for Pyspark","id":"2CA4YSTC7","angularObjects":{"2C27DN6PF:shared_process":[],"2C49UH56G:shared_process":[],"2C3ST4TYA:shared_process":[],"2C32ZU7YM:shared_process":[],"2C2E1VYCK:shared_process":[],"2C2V2GJUA:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}